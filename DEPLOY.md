# Деплой бэкенда Dancelot (Render)

Чтобы пользователи по ссылке из `/login` могли войти и видеть базу рекапов, разверни бэкенд на Render.

## Шаги

### 1. Аккаунт и репозиторий

- Зайди на [render.com](https://render.com) и залогинься (можно через GitHub).
- Убедись, что репозиторий [NikitaMorgos/Dancelot](https://github.com/NikitaMorgos/Dancelot) есть на GitHub и в нём есть `render.yaml`.

### 2. Новый Web Service

- В Render: **Dashboard** → **New** → **Web Service**.
- Подключи репозиторий **NikitaMorgos/Dancelot** (если ещё не подключён — **Connect account** для GitHub и выбери репо).
- В списке репозиториев выбери **Dancelot** → **Connect**.

### 3. Настройки сервиса

Render может подхватить настройки из `render.yaml`. Проверь:

| Поле | Значение |
|------|----------|
| **Name** | dancelot (или как хочешь) |
| **Region** | любой |
| **Branch** | main |
| **Runtime** | Node |
| **Build Command** | `npm install` |
| **Start Command** | `npm run start:all` |
| **Plan** | Free |

Если создаёшь сервис без Blueprint — укажи Build и Start вручную, как в таблице.

### 4. Переменные окружения (Environment)

В разделе **Environment** добавь переменные:

| Key | Value | Обязательно |
|-----|--------|--------------|
| `TELEGRAM_BOT_TOKEN` | токен от @BotFather (одна строка, без переносов) | да |
| `BOT_USERNAME` | `Dancelot_bot` | да |

**Не задавай** `SITE_URL` — на Render подставится `RENDER_EXTERNAL_URL`, бот по `/login` будет отдавать ссылку на твой сервис.

Опционально:

- `DATABASE_PATH` — по умолчанию `./data/dancelot.db` (на Free-плане диск эфемерный, при перезапуске БД обнулится).
- `PORT` — задаётся Render автоматически.

### 5. Деплой

- Нажми **Create Web Service**.
- Дождись окончания сборки и запуска (логи в панели).
- Сервис получит URL вида `https://dancelot-xxxx.onrender.com`.

### 6. Проверка

1. Открой в браузере `https://твой-сервис.onrender.com` — должна открыться страница входа.
2. В Telegram отправь боту команду `/login` — в ответ должна прийти ссылка на `https://твой-сервис.onrender.com/auth/verify?t=...`.
3. Открой эту ссылку — должен произойти вход и переход в базу рекапов.

Если бот по-прежнему присылает ссылку на GitHub Pages — проверь, что деплой прошёл и сервис в статусе **Running**, и перезапусти бота (на Render это перезапуск сервиса).

## Важно

- **Бесплатный план:** сервис засыпает после ~15 мин без запросов; первый запрос после сна может идти 30–60 сек. Диск эфемерный — при рестарте данные БД пропадают.
- **Постоянные данные:** для сохранения БД между перезапусками нужен [Render Disk](https://render.com/docs/disks) (платно) или перенос БД во внешний сервис.
