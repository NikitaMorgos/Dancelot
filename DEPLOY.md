# Деплой бэкенда Dancelot на Render — пошагово

Изменения уже запушены в GitHub. Дальше — только действия в браузере и копирование токена.

---

## Шаг 1. Открой Render

1. Открой в браузере: **https://dashboard.render.com**
2. Если нет аккаунта — нажми **Get Started** и войди через **GitHub** (удобнее всего).
3. Разреши Render доступ к GitHub, если попросит.

---

## Шаг 2. Создай Web Service

1. На главной странице Render нажми синюю кнопку **New +**.
2. В меню выбери **Web Service**.
3. Увидишь список репозиториев GitHub. Найди **Dancelot** (репо NikitaMorgos/Dancelot).
   - Если репозитория нет в списке — нажми **Configure account** или **Connect account** и дай доступ к нужному аккаунту/репо, затем снова выбери **Dancelot**.
4. Нажми **Connect** напротив **Dancelot**.

---

## Шаг 3. Настройки сервиса

На странице создания сервиса проверь (часть может подтянуться из `render.yaml`):

| Поле | Что указать |
|------|-------------|
| **Name** | `dancelot` (или любое имя — из него будет часть URL). |
| **Region** | оставь по умолчанию (например Frankfurt). |
| **Branch** | `main`. |
| **Runtime** | **Node**. |
| **Build Command** | `npm install` |
| **Start Command** | `npm run start:all` |
| **Plan** | **Free** |

Если какое-то поле пустое — впиши вручную, как в таблице.

---

## Шаг 4. Переменные окружения (обязательно)

1. На той же странице найди блок **Environment** (ниже настроек сборки).
2. Нажми **Add Environment Variable** (или **+ Add**).
3. Добавь две переменные по одной:

   **Первая:**
   - **Key:** `TELEGRAM_BOT_TOKEN`
   - **Value:** вставь свой токен от @BotFather (тот же, что в твоём `.env`). Одна строка, без пробелов и переносов в середине.

   **Вторая:**
   - **Key:** `BOT_USERNAME`
   - **Value:** `Dancelot_bot`

4. Переменную `SITE_URL` **не добавляй** — на Render подставится адрес сервиса сам.

---

## Шаг 5. Запуск деплоя

1. Внизу страницы нажми **Create Web Service**.
2. Начнётся сборка: в логах будет видно `npm install`, потом запуск. Подожди 2–5 минут.
3. Когда вверху статус станет **Live** (зелёный), сервис работает.
4. Скопируй URL сервиса — он вверху страницы, вида **https://dancelot-xxxx.onrender.com** (или как ты назвал сервис).

---

## Шаг 6. Проверка

1. **Сайт:** открой скопированный URL в браузере. Должна открыться страница входа Dancelot («Войти по ссылке» и т.д.).
2. **Бот:** в Telegram отправь боту **@Dancelot_bot** команду **/login**.
   - В ответ должна прийти ссылка вида `https://dancelot-xxxx.onrender.com/auth/verify?t=...` (твой URL, не localhost и не GitHub).
3. **Вход:** открой эту ссылку из бота в браузере. Должен произойти вход и переход в базу рекапов.

Если бот всё ещё присылает ссылку на GitHub Pages — подожди 1–2 минуты после деплоя и отправь **/login** ещё раз (бот уже работает на Render и подхватывает новый URL).

---

## Если что-то пошло не так

- **Сборка падает:** посмотри логи в Render (вкладка **Logs**). Часто причина — не задан `TELEGRAM_BOT_TOKEN` в Environment.
- **Страница не открывается:** проверь, что статус **Live**, и открой именно URL из Render (с https://).
- **Бот не отвечает:** убедись, что деплой завершён и в логах нет ошибок при запуске. Один процесс на Render и бота, и сервер — они стартуют вместе.

---

## Важно про бесплатный план

- Сервис «засыпает» после примерно 15 минут без запросов. Первый запрос после сна может выполняться 30–60 секунд.
- Файлы на диске (в т.ч. база SQLite) при перезапуске сервиса пропадают. Для постоянной базы нужен платный диск (Render Disk) или внешняя БД.

---

Кратко: зайти на render.com → New → Web Service → Dancelot → Connect → в Environment добавить `TELEGRAM_BOT_TOKEN` и `BOT_USERNAME` → Create Web Service → дождаться Live → проверить сайт и /login в боте.
