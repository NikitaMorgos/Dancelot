# Dancelot — AI-поддержка танцора

База знаний по мастер-классам, доступ из Telegram-бота и с веб-сайта. Планируются: конкурсы, тренировки, прогресс, кабинет тренера.

## Возможности

- **Telegram-бот**: отправляешь видео рекапа с подписью — бот сохраняет в базу (стиль, уровень, навык, заметки). Команды `/list`, `/login`, меню с командами.
- **Веб-сайт**: вход по ссылке из бота (`/login`), дашборд с рекапами, фильтры по стилю, просмотр заметок и видео.
- **База**: SQLite (файл `data/dancelot.db`), структура по стилю/уровню/типу навыка.

## Требования

- Node.js 18+
- Telegram-бот (токен от [@BotFather](https://t.me/BotFather))

## Установка

```bash
git clone https://github.com/NikitaMorgos/Dancelot.git
cd dancelot
npm install
```

Создай файл `.env` в корне (скопируй из `.env.example`):

```env
TELEGRAM_BOT_TOKEN=токен_от_BotFather
BOT_USERNAME=Dancelot_bot
DATABASE_PATH=./data/dancelot.db
PORT=3000
SITE_URL=http://localhost:3000
```

Токен — **в одну строку**, без переносов. Имя бота (`BOT_USERNAME`) — без `@`, как в BotFather.

## Запуск

**Инициализация БД (один раз):**

```bash
npm run db:init
```

**Бот:**

```bash
npm run bot
```

Или на Windows: двойной клик по `start-bot.cmd`.

**Сайт:**

```bash
npm run server
```

Открой в браузере: http://localhost:3000

Или на Windows: `start-server.cmd`.

## Вход на сайт

1. Открой бота в Telegram, отправь **/login**.
2. Скопируй ссылку из ответа и открой её в браузере — попадёшь в базу рекапов.

(Кнопка «Log in with Telegram» на сайте работает только если домен настроен в BotFather.)

## Формат рекапа (подпись к видео)

По желанию в подписи к видео укажи:

- **Стиль:** WCS | хастл | бачата | зук | СБТ | другое  
- **Уровень:** начальный | средний | продвинутый | все уровни  
- **Навык:** техника | партнёрство | музыкальность | шоу | импровизация | другое  
- **Название:** тема МК  

Остальной текст — заметки.

## Скрипты

| Команда        | Описание              |
|----------------|------------------------|
| `npm run bot`  | Запуск Telegram-бота   |
| `npm run server` | Запуск веб-сервера   |
| `npm run start:all` | Бот и сервер в одном процессе (для деплоя) |
| `npm run db:init` | Создание БД (один раз) |
| `npm run build` | Сборка TypeScript     |

## Деплой (логин и база рекапов в интернете)

Чтобы пользователи могли по ссылке из `/login` заходить на сайт и видеть свою базу рекапов, нужно развернуть бэкенд (бот + сервер) в интернете.

1. **Один процесс** — бот и веб-сервер в одном приложении (общая БД, токены из `/login` работают на сайте):
   ```bash
   npm run start:all
   ```

2. **Пример: Render.com**  
   - Подробно: [DEPLOY.md](DEPLOY.md).  
   - В репозитории есть `render.yaml`: New → Web Service → подключи репо Dancelot, задай в Environment `TELEGRAM_BOT_TOKEN` и `BOT_USERNAME`, деплой.  
   - **Start Command:** `npm run start:all`. На Render ссылку для `/login` бот возьмёт из `RENDER_EXTERNAL_URL`, отдельно `SITE_URL` задавать не нужно.  
   - На бесплатном тарифе диск эфемерный — при перезапуске сервиса БД обнулится. Для постоянной базы нужен платный диск или внешняя БД.

3. После деплоя открой сайт по выданному URL, зайди в бота, отправь `/login` — в ответ придёт ссылка на твой развёрнутый сайт; по ней можно войти и смотреть базу рекапов.

## GitHub Pages

Чтобы сайт открывался по адресу `https://nikitamorgos.github.io/Dancelot/`:

1. В репозитории на GitHub: **Settings** → **Pages**.
2. **Source:** Deploy from a branch.
3. **Branch:** `main` → папка **/docs** → Save.

Через 1–2 минуты страница будет доступна по ссылке выше.

## Лицензия

MIT
